trigger: none

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Terraform
  jobs:
  - job: Terraform
    steps:
    - checkout: self
      persistCredentials: true

    - task: TerraformInstaller
      displayName: Install terraform
      inputs:
        terraformVersion: 1.5.4

    - script: terraform init
      displayName: 'Terraform init'

    - script: terraform validate
      displayName: 'Terraform validate'

    - script: terraform plan
      displayName: 'Terraform plan'

    - script: terraform apply -auto-approve
      displayName: 'Terraform apply'
