<!DOCTYPE html>
<html>

<head>
    <title>Managed Identities</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        h1 {
            background-color: #008AD7;
            color: white;
            padding: 1em;
            margin: 0;
        }
        
        form {
            padding: 2em;
        }
        
        .identity {
            border: 1px solid #ccc;
            margin-bottom: 2em;
            padding: 1em;
            border-radius: 5px;
        }
        
        .role {
            border: 1px dashed #ccc;
            margin: 1em;
            padding: 1em;
        }
        
        button,
        input[type="submit"] {
            background-color: #008AD7;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }
        
        button:hover,
        input[type="submit"]:hover {
            background-color: #008AD7;
        }
    </style>
</head>

<body>
  <h1>Managed Identities</h1>
  <form action="/" method="post">
      <input type="hidden" id="id_count" name="id_count" value="0">
      <input type="hidden" name="deleted_identities" id="deleted_identities" value="[]">
      <input type="hidden" name="deleted_roles" id="deleted_roles" value="[]">
      <div id="identities">
          <!-- Identities will be inserted here -->
      </div>
      <button type="button" onclick="addIdentity()">Add Identity</button>
      <input type="submit" value="Submit">
  </form>
  <script>
      let identityCount = 0;
      let roleCount = 0;
      let deletedIdentities = [];
      let deletedRoles = [];

      function addIdentity() {
          identityCount++;
          const identityDiv = document.createElement('div');
          identityDiv.id = `identity_${identityCount}`;
          identityDiv.innerHTML = `<label>Managed Identity: <input type="text" name="id_${identityCount}"></label>`;
          identityDiv.innerHTML += `<div id="roles_${identityCount}"></div>`;
          identityDiv.innerHTML += `<button type="button" onclick="addRole(${identityCount})">Add Another Role</button>`;
          identityDiv.innerHTML += `<button type="button" onclick="deleteIdentity(${identityCount})">Delete Identity</button>`;
          document.getElementById('identities').appendChild(identityDiv);
          document.getElementById('id_count').value = identityCount;
      }

      function addRole(identityId) {
          roleCount++;
          const roleDiv = document.createElement('div');
          roleDiv.id = `role_${identityId}_${roleCount}`;
          roleDiv.innerHTML = `<label>Scope: <select name="scope_${identityId}_${roleCount}"><option value="/subscriptions/865f86e6-0a9a-4c2f-8742-ce207e509dad">Subscription 'Personal'</option><option value="/subscriptions/865f86e6-0a9a-4c2f-8742-ce207e509dad/resourceGroups/mi_flask_poc">Resource Group 'mi_flask_poc'</option></select></label>`;
          roleDiv.innerHTML += `<label>Role Definition: <select name="role_definition_${identityId}_${roleCount}"><option value="Reader">Reader</option><option value="Contributor">Contributor</option></select></label>`;
          roleDiv.innerHTML += `<label>Description: <input type="text" name="description_${identityId}_${roleCount}"></label>`;
          roleDiv.innerHTML += `<button type="button" onclick="deleteRole(${identityId}, ${roleCount})">Delete Role</button>`;
          document.getElementById(`roles_${identityId}`).appendChild(roleDiv);
      }

      function deleteIdentity(identityId) {
          const identityDiv = document.getElementById(`identity_${identityId}`);
          identityDiv.remove();
          deletedIdentities.push(identityId);
          document.getElementById('deleted_identities').value = JSON.stringify(deletedIdentities);
          identityCount--;
          document.getElementById('id_count').value = identityCount;
      }

      function deleteRole(identityId, roleId) {
          const roleDiv = document.getElementById(`role_${identityId}_${roleId}`);
          roleDiv.remove();
          deletedRoles.push(`${identityId}_${roleId}`);
          document.getElementById('deleted_roles').value = JSON.stringify(deletedRoles);
      }
  </script>
</body>

</html>