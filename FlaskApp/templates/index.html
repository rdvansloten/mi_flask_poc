<!DOCTYPE html>
<html>

<head>
    <title>Managed Identities</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        h1 {
            background-color: #4CAF50;
            color: white;
            padding: 1em;
            margin: 0;
        }
        
        form {
            padding: 2em;
        }
        
        .identity {
            border: 1px solid #ccc;
            margin-bottom: 2em;
            padding: 1em;
            border-radius: 5px;
        }
        
        .role {
            border: 1px dashed #ccc;
            margin: 1em;
            padding: 1em;
        }
        
        button,
        input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }
        
        button:hover,
        input[type="submit"]:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body>
    <h1>Managed Identities</h1>
    <form action="/" method="post">
        <input type="hidden" id="id_count" name="id_count" value="1">
        <div id="identities">
            <div class="identity" id="identity_1">
                <label>ID: <input type="text" name="id_1"></label>
                <input type="hidden" id="roles_count_1" name="roles_count_1" value="1">
                <div id="roles_1">
                    <div class="role" id="role_1_1">
                        <label>Scope:</label>
                        <select name="scope_1_1">
                            <option value="/subscriptions/0000...">Option 1</option>
                            <option value="/subscriptions/1111...">Option 2</option>
                        </select>
                        <label>Role Definition:</label>
                        <select name="role_definition_1_1">
                            <option value="Storage Account Contributor">Storage Account Contributor</option>
                            <option value="Reader">Reader</option>
                        </select>
                        <label>Description:</label>
                        <input type="text" name="description_1_1">
                    </div>
                </div>
                <button type="button" onclick="addRole(1)">Add Another Role</button>
            </div>
        </div>
        <button type="button" onclick="addIdentity()">Add Another Identity</button>
        <input type="submit" value="Submit">
    </form>
    <script>
        let identityCount = 1;
        let roleCounts = { 1: 1 };

        function addIdentity() {
            identityCount++;
            const identityDiv = document.createElement('div');
            identityDiv.className = "identity";
            identityDiv.id = `identity_${identityCount}`;
            identityDiv.innerHTML = `
                <label>ID: <input type="text" name="id_${identityCount}"></label>
                <input type="hidden" id="roles_count_${identityCount}" name="roles_count_${identityCount}" value="1">
                <div id="roles_${identityCount}">
                    <div class="role" id="role_${identityCount}_1">
                        <label>Scope:</label>
                        <select name="scope_${identityCount}_1">
                            <option value="/subscriptions/865f86e6-0a9a-4c2f-8742-ce207e509dad">Subscription "Personal"</option>
                            <option value="/subscriptions/865f86e6-0a9a-4c2f-8742-ce207e509dad/resourceGroups/mi_flask_poc">Resource Group "mi_flask_poc"</option>
                        </select>
                        <label>Role Definition:</label>
                        <select name="role_definition_${identityCount}_1">
                            <option value="Contributor">Contributor</option>
                            <option value="Reader">Reader</option>
                        </select>
                        <label>Description:</label>
                        <input type="text" name="description_${identityCount}_1">
                    </div>
                </div>
                <button type="button" onclick="addRole(${identityCount})">Add Another Role</button>
            `;
            document.getElementById('identities').appendChild(identityDiv);
            document.getElementById('id_count').value = identityCount;
            roleCounts[identityCount] = 1;
        }

        function addRole(identityId) {
            roleCounts[identityId]++;
            const roleDiv = document.createElement('div');
            roleDiv.className = "role";
            roleDiv.id = `role_${identityId}_${roleCounts[identityId]}`;
            roleDiv.innerHTML = `
                <label>Scope:</label>
                <select name="scope_${identityId}_${roleCounts[identityId]}">
                    <option value="/subscriptions/0000...">Option 1</option>
                    <option value="/subscriptions/1111...">Option 2</option>
                </select>
                <label>Role Definition:</label>
                <select name="role_definition_${identityId}_${roleCounts[identityId]}">
                    <option value="Storage Account Contributor">Storage Account Contributor</option>
                    <option value="Reader">Reader</option>
                </select>
                <label>Description:</label>
                <input type="text" name="description_${identityId}_${roleCounts[identityId]}">
            `;
            document.getElementById(`roles_${identityId}`).appendChild(roleDiv);
            document.getElementById(`roles_count_${identityId}`).value = roleCounts[identityId];
        }
    </script>
</body>

</html>
